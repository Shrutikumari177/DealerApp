sap.ui.define(["sap/ui/core/mvc/Controller"],e=>{"use strict";let t;let o;return e.extend("com.ingenx.dealer.controller.DealerDashboard",{onInit:async function(){await this.getLoggedInUserInfo();t=await this.checkforValidUser();this.getDealerOc(t);let e={isDisplay:true,isHide:false};let o=new sap.ui.model.json.JSONModel(e);this.getView().setModel(o,"isDisplayModel")},getLoggedInUserInfo:async function(){try{let e=await sap.ushell.Container.getService("UserInfo");let t=e.getId();o=e.getEmail();let a=e.getFullName();console.log("userEmail",o);console.log("userFullName",a);console.log("userID",t)}catch(e){o="shruti.kumari@ingenxtec.com";console.log("hiii",o)}},checkforValidUser:async function(){let e=o;if(e==="shruti.kumari@ingenxtec.com"){let e="1100000003";return e}else if(e==="ashwani.sharma@ingenxtec.com"){let e="21000001";return e}else{console.log("No vendor found for the logged-in user");return null}},getDealerOc:async function(){const e=this.getOwnerComponent().getModel();const o=e.bindList(`/getDealerDashOCValueHelp(DealerId='${t}')`);const a=[];try{const e=await o.requestContexts();e.forEach(e=>{a.push(e.getObject())})}catch(e){throw new Error("Error fetching batch details: "+e.message)}console.log("Fetched Data:",a);const r=new sap.ui.model.json.JSONModel;r.setData({OCData:a});this.getOwnerComponent().setModel(r,"OCModel");return a},onSelectContract:async function(e){try{var t=e.getSource();var o=t.getBindingContext("OCModel");if(!o){console.error("Binding context is undefined");return}var a=o.getProperty("OCID");console.log("Selected OCID:",a);let n=this.getOwnerComponent().getModel();let s=`/getProductionTrackingDashboardData(OCID='${a}')`;const i=n.bindContext(s,null,{});const d=await i.requestObject();let c=d.value[0];let g=c.ProductionOrder;let u=c.ManufactureDt;let h=c.ExpiryDt;let D=c.BatchID;let C=c.Material;console.table("oNewModel",c);const m=c.ICs.flatMap(e=>e.Boxes.map(t=>({ICID:e.ICID,ICQRCode:e.ICQRCode,ICQRCodeUrl:e.ICQRCodeURL,BoxSerialNo:t.SerialNo,BoxQRCode:t.BoxQRCode,BoxQRCodeUrl:t.BoxQRCodeURL,pOrder:g,mfgDate:u,expDate:h,BatchID:D,Material:C})));var r=new sap.ui.model.json.JSONModel;r.setData(m);console.log("result update data",m);this.getView().setModel(r,"newArrayModel");var l=new sap.ui.model.json.JSONModel;l.setData(c);this.getView().setModel(l,"newModel")}catch(e){console.error("Error fetching data:",e)}},lengthFormatter:function(e){if(Array.isArray(e)){return e.length}return 0},boxLengthFormatter:function(e){if(Array.isArray(e)){let t=e.map(e=>e.Boxes);let o=t.flat();return o.length}return 0},onScanSuccess:function(e){if(e.getParameter("cancelled")){MessageToast.show("Scan cancelled",{duration:1e3})}else{var t=e.getParameter("text");if(t){var o=JSON.parse(t);let e=o.ProductionOrder;let a=o.ManufactureDt;let r=o.ExpiryDt;let l=o.BatchID;let n=o.Material;const s=o.ICs.flatMap(t=>t.Boxes.map(o=>({ICID:t.ICID,ICQRCode:t.ICQRCode,ICQRCodeUrl:t.ICQRCodeURL,BoxSerialNo:o.SerialNo,BoxQRCode:o.BoxQRCode,BoxQRCodeUrl:o.BoxQRCodeURL,pOrder:e,mfgDate:a,expDate:r,BatchID:l,Material:n})));let i=new sap.ui.model.json.JSONModel(s);this.getView().setModel(i,"ICScannerDataModel");let d=this.getView().getModel("isDisplayModel");d.setProperty("/isHide",true);d.setProperty("/isDisplay",false);console.log("bar code data data",this.getView().getModel("ICScannerDataModel").getData());let c=new sap.ui.model.json.JSONModel(o);this.getView().setModel(c,"barScannerDataModel")}else{MessageToast.show("No data found in scan",{duration:1e3})}}},onDealerDashboardICQrCode:function(e){let t=e.getSource();let o=t.getBindingContext("newArrayModel");let a=o.getObject();let r=a.ICQRCodeUrl;let l=this.byId("DealerDashboard_QRDialog");let n=this.byId("DealerDashboard_QRImage");n.setSrc(r);l.open()},onCloseQRDialog:function(){this.byId("DealerDashboard_QRDialog").close()},onDealerDashboardPrintQR:function(){var e=this.byId("dashboardDetailsqrImage");var t=e.getSrc();if(t){var o=new Image;o.onload=function(){console.log("Image loaded successfully. Proceeding to print...");var e=window.open("","_blank");e.document.write("<html><head><title>Print QR Code</title></head><body>");e.document.write('<img src="'+t+'" style="width:200px;height:200px;"/>');e.document.write("</body></html>");e.document.close();setTimeout(()=>{e.print();e.close()},500)};o.onerror=function(){console.error("Failed to load the QR code image from URL:",t);sap.m.MessageToast.show("Failed to load the QR code image.")};o.src=t}else{console.warn("QR Code source is empty or undefined.");sap.m.MessageToast.show("QR Code is not available for printing.")}},onDealerDashboardBoxQrCode:function(e){let t=e.getSource();let o=t.getBindingContext("newArrayModel");let a=o.getObject();let r=a.BoxQRCodeUrl;let l=this.byId("DealerDashboard_QRDialog");let n=this.byId("DealerDashboard_QRImage");n.setSrc(r);l.open()}})});
//# sourceMappingURL=DealerDashboard.controller.js.map