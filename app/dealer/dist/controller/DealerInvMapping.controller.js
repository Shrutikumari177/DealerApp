sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","com/ingenx/dealer/utils/HelperFunction","sap/m/MessageBox"],(e,t,l,a,i,n,o)=>{"use strict";let r;let s;let u;return e.extend("com.ingenx.dealer.controller.DealerInvMapping",{onInit(){this.getLoggedInUserInfo()},getLoggedInUserInfo:async function(){try{let e=await sap.ushell.Container.getService("UserInfo");u=e.getId();s=e.getEmail();let t=e.getFullName();console.log("userEmail",s);console.log("userFullName",t);console.log("userID",u);this.checkforValidUser()}catch(e){s=undefined;console.log("hiii",s)}},checkforValidUser:async function(){let e=s;if(e==="DEFAULT_USER"){r="1100000003";console.log("dealer found for Shruti Kumari",r);return r}else if(e==="rishabh.tiwari@ingenxtec.com"){r="100010";console.log("dealer found for Rishbh Tiwari",r);return r}else{console.log("No dealer found for the logged-in user");return null}},onSelectChange:async function(e){var t=e.getSource().getSelectedKey();this._selectedKey=t;let l="";if(this._selectedKey==="OC"){l="OuterContainer"}else if(this._selectedKey==="IC"){l="InnerContainer"}else{l="Box"}let a=`getOCValueHelpforRetailerMapping?DealerId='1100000003'&SelectionType='${l}'`;let n=this.getOwnerComponent().getModel();let o=n.bindList(`/${a}`);try{let e=await o.requestContexts(0,Infinity);let t=e.map(e=>e.getObject());console.log("selected data",t);let l=new i(t);this.getView().setModel(l,"allSelectedItemModel")}catch(e){console.warn(e)}this.onVisibleFields([{id:"mapping_ocValueHelpInput",bValue:false},{id:"invMapping_LabelOC",bValue:false},{id:"mapping_IcValueHelpInput",bValue:false},{id:"invMapping_LabelIC",bValue:false},{id:"mapping_BOXValueHelpInput",bValue:false},{id:"invMapping_LabelBOX",bValue:false},{id:"invMapping_BlockLayoutCellOC",bValue:false},{id:"invMapping_BlockLayoutCellIC",bValue:false},{id:"invMapping_BlockLayoutCellBOX",bValue:false}]);switch(t){case"OC":this.onVisibleFields([{id:"mapping_ocValueHelpInput",bValue:true},{id:"invMapping_LabelOC",bValue:true},{id:"invMapping_BlockLayoutCellOC",bValue:true}]);break;case"IC":this.onVisibleFields([{id:"mapping_IcValueHelpInput",bValue:true},{id:"invMapping_LabelIC",bValue:true},{id:"invMapping_BlockLayoutCellIC",bValue:true}]);break;case"BOX":this.onVisibleFields([{id:"mapping_BOXValueHelpInput",bValue:true},{id:"invMapping_LabelBOX",bValue:true},{id:"invMapping_BlockLayoutCellBOX",bValue:true}]);break;default:break}this.refreshUiFields()},onVisibleFields:function(e){if(Array.isArray(e)){e.forEach(e=>{let t=this.getView().byId(e?.id);if(t){t.setVisible(e.bValue)}else{console.log(`${t} not Found`)}})}else{console.log("ID is not a Array")}},onBoxValueHelp:function(){n._openValueHelpDialog(this,"ocBoxValueHelp","com.ingenx.dealer.fragments.boxValueHelp")},onOCValueHelp:async function(){n._openValueHelpDialog(this,"ocRetailerValueHelp","com.ingenx.dealer.fragments.ocRetailerValueHelp")},onOCValueHelpSearch:function(e){n._valueHelpLiveSearch(e,"OCID")},onOCOCValueConfirmItem:async function(e){n._valueHelpSelectedValue(e,this,"mapping_ocValueHelpInput")},onBoxValueConfirmItem:async function(e){n._valueHelpSelectedValue(e,this,"mapping_BOXValueHelpInput")},onOCValueConfirmItemtrigger:async function(){let e=this.getView().byId("mapping_ocValueHelpInput").getValue();try{let t=await n._getSingleEntityDataWithParam(this,"getDealerOcIcBoxMappingdata","OCID",e);console.log("oData",t);let l=this.getOwnerComponent().getModel("filteredDataModel");if(!l){l=new sap.ui.model.json.JSONModel;this.getOwnerComponent().setModel(l,"filteredDataModel")}l.setData(t[0]);console.log("Data set in filteredDataModel:",l.getData());let a=t.length>0?t[0].RetailerID:null;let i=this.getView().byId("mapping_retailerValueHelpInput");let o=this.getView().byId("invMapping_ButtonOC");if(a){i.setEditable(false);o.setVisible(false)}else{i.setEditable(true);o.setVisible(true)}}catch(e){console.error("Error fetching filtered data:",e)}},onICValueHelp:async function(){n._openValueHelpDialog(this,"icRetailerValueHelp","com.ingenx.dealer.fragments.icRetailerValueHelp")},onICValueHelpSearch:function(e){n._valueHelpLiveSearch(e,"ICID")},onICValueConfirmItem:async function(e){n._valueHelpSelectedValue(e,this,"mapping_IcValueHelpInput")},onICValueConfirmItemtrigger:async function(){let e=this.getView().byId("mapping_IcValueHelpInput").getValue();try{let t=await n._getSingleEntityDataWithParam(this,"getDealerOcIcBoxMappingdata","ICID",e);console.log("oData",t);let l=this.getOwnerComponent().getModel("filteredDataModel");if(!l){l=new sap.ui.model.json.JSONModel;this.getOwnerComponent().setModel(l,"filteredDataModel")}l.setData(t[0]);let a=t.length>0?t[0].RetailerID:null;let i=this.getView().byId("invMapping_retailerValueHelpInput");let o=this.getView().byId("invMapping_ButtonIC");if(a){i.setEditable(false);o.setVisible(false)}else{i.setEditable(true);o.setVisible(true)}}catch(e){console.error("Error fetching filtered data:",e);o.error("Failed to fetch filtered data. Please try again.")}},onBOXValueConfirmItemtrigger:async function(){let e=this.getView().byId("mapping_BOXValueHelpInput").getValue();try{let t=await n._getSingleEntityDataWithParam(this,"getDealerOcIcBoxMappingdata","SerialNo",e);console.log("oData",t);let l=this.getOwnerComponent().getModel("filteredDataModel");if(!l){l=new sap.ui.model.json.JSONModel;this.getOwnerComponent().setModel(l,"filteredDataModel")}l.setData(t[0]);console.log("Data set in filteredDataModel:",l.getData());let a=t.length>0?t[0].RetailerID:null;let i=this.getView().byId("invMapping_retailerValueHelpInput");let o=this.getView().byId("invMapping_ButtonIC");if(a){i.setEditable(false);o.setVisible(false)}else{i.setEditable(true);o.setVisible(true)}}catch(e){console.error("Error fetching filtered data:",e)}},_onMappingGoButtonPress:function(){switch(this._selectedKey){case"OC":this.onOCValueConfirmItemtrigger();break;case"IC":this.onICValueConfirmItemtrigger();break;case"BOX":this.onBOXValueConfirmItemtrigger();break;default:console.warn("No valid selection made.");break}},_onOpenReatilerValueHelp:function(){n._openValueHelpDialog(this,"RetailerValueHelp","com.ingenx.dealer.fragments.retailerValueHelp")},onRetailerValueHelpSearch:function(e){n._valueHelpLiveSearch(e,"RetailerId")},onRetailerValueConfirmItem:async function(e){try{let t=e.getParameter("selectedItem");if(!t){throw new Error("No item selected.")}let l=t.getBindingContext();if(!l){throw new Error("Binding context not found.")}let a=l.getProperty("RetailerId");let i=l.getProperty("Name");let o=l.getProperty("TaxNo");this.getView().byId("mapping_retailerNameInput").setValue(i);this.getView().byId("retailerTaxField").setValue(o);this.getView().byId("mapping_retailerValueHelpInput").setValue(a);n._valueHelpSelectedValue(e,this,"mapping_retailerValueHelpInput")}catch(e){console.error("Error in onRetailerValueConfirmItem:",e.message);sap.m.MessageBox.error("An error occurred while selecting a retailer: "+e.message)}},refreshUiFields:function(){let e=this.getView().getModel("filteredDataModel");if(e){e.setData({});e.refresh(true)}else{console.warn("The filteredDataModel is not defined.")}},onSubmitMappingData:function(){try{debugger;let e=n._getInputValues(this,["mapping_ocValueHelpInput","mapping_IcValueHelpInput","mapping_BOXValueHelpInput","mapping_retailerValueHelpInput","retailerTaxField"]);let[t,l,a,i,o]=e;if(!t&&!l&&!a){throw new Error("Neither OCID nor ICID is provided.")}if(l){let e={IC_ICID:l,RetailerId:i,TaxNo:o};console.log("Payload for IC:",e);this._sendToBackendOC(e)}if(t){let e={OC_OCID:t,RetailerId:i,TaxNo:o};console.log("Payload for OC:",e);this._sendToBackendOC(e)}if(a){let e={SerialNo:a,RetailerId:i,TaxNo:o};console.log("Payload for OC:",e);this._sendToBackendOC(e)}}catch(e){console.error("Error in onSubmitMappingData:",e.message);sap.m.MessageBox.error(e.message)}},_sendToBackendOC:async function(e){try{console.log("Sending payload to backend:",e);var t=this.getOwnerComponent().getModel();if(!t){throw new Error("OData V4 model not found.")}let l="/MapRetailer(...)";const a=t.bindContext(l,undefined);if(e.OC_OCID){a.setParameter("OC_OCID",e.OC_OCID)}if(e.IC_ICID){a.setParameter("IC_ICID",e.IC_ICID)}if(e.SerialNo){a.setParameter("SerialNo",e.SerialNo)}if(e.RetailerId){a.setParameter("RetailerId",e.RetailerId)}if(e.TaxNo){a.setParameter("TaxNo",e.TaxNo)}await a.execute();console.log("Mapping Done successfully:");sap.m.MessageToast.show("Action executed successfully!")}catch(e){console.error("Error executing action:",e);sap.m.MessageBox.error(e.message)}}})});
//# sourceMappingURL=DealerInvMapping.controller.js.map